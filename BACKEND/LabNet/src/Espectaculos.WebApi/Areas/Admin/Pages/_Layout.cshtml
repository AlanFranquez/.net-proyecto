@using System
@using Microsoft.AspNetCore.Mvc.RazorPages
@using Microsoft.AspNetCore.Mvc.RazorPages.Infrastructure
@inherits Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Backoffice - @ViewData["Title"]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/css/site.css" asp-append-version="true" />
    <!-- Iconos de Bootstrap (opcional) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
</head>
<body>
@{
    // Página actual (para marcar item activo en la sidebar)
    var pad = ViewContext?.ActionDescriptor as PageActionDescriptor;
    string? currentPage = pad?.ViewEnginePath;

    string Active(string prefix)
        => (currentPage?.StartsWith(prefix, StringComparison.OrdinalIgnoreCase) ?? false)
            ? "active"
            : "";
}

<div class="shell">
    <aside class="sidebar">
        <div class="brand">Backoffice</div>

        <nav class="nav">
            <a asp-area="Admin" asp-page="/Dashboard/Index">
                <i class="bi bi-speedometer2"></i> Dashboard
            </a>

            <a class="@Active("/Admin/Usuarios")"
               asp-area="Admin" asp-page="/Usuarios/Index">
                <i class="bi bi-people"></i> Gestión de usuarios
            </a>

            <a class="@Active("/Admin/Roles")"
               asp-area="Admin" asp-page="/Roles/Index">
                <i class="bi bi-shield-lock"></i> Roles
            </a>

            <a class="@Active("/Admin/Espacios")"
               asp-area="Admin" asp-page="/Espacios/Index">
                <i class="bi bi-grid-3x3-gap"></i> Espacios
            </a>

            <a class="@Active("/Admin/Reglas")"
               asp-area="Admin" asp-page="/Reglas/Index">
                <i class="bi bi-diagram-3"></i> Reglas de acceso
            </a>

            <a class="@Active("/Admin/Beneficios")"
               asp-area="Admin" asp-page="/Beneficios/Index">
                <i class="bi bi-gift"></i> Beneficios
            </a>

            <!-- 🔑 Nuevo menú: Credenciales -->
            <a class="@Active("/Admin/Credenciales")"
               asp-area="Admin" asp-page="/Credenciales/Index">
                <i class="bi bi-key"></i> Credenciales
            </a>

            <a class="@Active("/Admin/Novedades")"
               asp-area="Admin" asp-page="/Novedades/Index">
                <i class="bi bi-megaphone"></i> Novedades
            </a>

            <a class="@Active("/Admin/Reportes")"
               asp-area="Admin" asp-page="/Reportes/Index">
                <i class="bi bi-graph-up"></i> Reportes
            </a>

            <a class="@Active("/Admin/TestEventos")"
               asp-area="Admin" asp-page="/TestEventos/Index">
                <i class="bi bi-bug"></i> Test eventos
            </a>
        </nav>
    </aside>

    <main class="content">
        <div class="topbar">
            <div class="text-end small text-muted">
                @if (User?.Identity?.IsAuthenticated ?? false)
                {
                    var username = User.FindFirst("email")?.Value
                                   ?? User.Identity?.Name
                                   ?? "admin";

                    <form method="post" asp-area="Admin" asp-page="/Account/Logout" style="display:inline;">
                        <span class="me-2">
                            <i class="bi bi-person-circle"></i> @username
                        </span>
                        <button type="submit" class="btn-link">
                            <i class="bi bi-box-arrow-right"></i> Cerrar sesión
                        </button>
                    </form>
                }
                else
                {
                    <a asp-area="Admin" asp-page="/Account/Login">
                        <i class="bi bi-box-arrow-in-right"></i> Iniciar sesión
                    </a>
                }
            </div>
        </div>

        @RenderBody()
    </main>
</div>

<style>
    .nav a { display:block; padding:.5rem .75rem; border-radius:.5rem; text-decoration:none; color:inherit; }
    .nav a.active { background:rgba(13,110,253,.1); color:#0d6efd; font-weight:600; }
    .topbar { padding:.75rem 0; }

    .btn-link {
        background: none;
        border: none;
        padding: 0;
        margin: 0;
        color: #0d6efd;
        cursor: pointer;
        font-size: .85rem;
    }

    .btn-link:hover {
        text-decoration: underline;
    }
</style>

@* ✅ Sección Scripts para páginas *@
@await RenderSectionAsync("Scripts", required: false)
</body>
</html>
