@page
@using System
@using System.Globalization
@model Espectaculos.Backoffice.Areas.Admin.Pages.Reglas.IndexModel
@{
  ViewData["Title"] = "Reglas de acceso";
  var ci = CultureInfo.InvariantCulture;

  string Fmt(DateTime? dt)
  {
    if (!dt.HasValue) return "—";
    var v = dt.Value;
    if (v.Kind == DateTimeKind.Unspecified) v = DateTime.SpecifyKind(v, DateTimeKind.Utc);
    return v.ToLocalTime().ToString("yyyy-MM-dd", ci);
  }
  
}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">Reglas de acceso</h1>
  <a asp-area="Admin" asp-page="/Reglas/Crear" class="btn btn-primary">
    <i class="bi bi-plus-circle"></i> Nueva regla
  </a>
</div>

@if (TempData["Ok"] is string ok)
{
  <div class="alert alert-success py-2">@ok</div>
}

<div class="card shadow-sm border-0">
  <div class="card-body p-0">
    <table class="table table-hover table-sm mb-0 align-middle admin-table">
      <thead class="table-light">
        <tr>
          <th>Ventana</th>
          <th>Vigencia inicio</th>
          <th>Vigencia fin</th>
          <th>Política</th>
          <th>Prioridad</th>
          <th>Biometría</th>
          <th class="text-center">#Espacios</th>
          <th style="width:220px"></th>
        </tr>
      </thead>
      <tbody>
      @foreach (var r in Model.Items)
      {
        <tr>
          <td class="fw-medium">@r.VentanaHoraria</td>
          <td>@Fmt(r.VigenciaInicio)</td>
          <td>@Fmt(r.VigenciaFin)</td>
          <td>@r.Politica</td>
          <td>@r.Prioridad</td>
          <td>
            @if (r.RequiereBiometriaConfirmacion)
            { <span class="badge bg-success-subtle text-success-emphasis">Sí</span> }
            else
            { <span class="badge bg-secondary-subtle text-secondary-emphasis">No</span> }
          </td>
          <td class="text-center">@((r.EspaciosIDs?.Count) ?? 0)</td>
          <td class="text-end">
            <a asp-area="Admin" asp-page="/Reglas/Editar" asp-route-id="@r.ReglaId" class="btn btn-sm btn-outline-secondary">
              <i class="bi bi-pencil"></i> Editar
            </a>
            <form method="post" asp-page-handler="Delete" asp-route-id="@r.ReglaId" class="d-inline">
              @Html.AntiForgeryToken()
              <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('¿Eliminar regla?')">
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </form>
          </td>
        </tr>
      }
      </tbody>
    </table>
  </div>
</div>
