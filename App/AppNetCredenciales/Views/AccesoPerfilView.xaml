<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:AppNetCredenciales.Views"
             xmlns:converters="clr-namespace:AppNetCredenciales.Converters"
             x:Class="AppNetCredenciales.Views.AccesoPerfilView"
             Title="Detalle de acceso">

    <Grid RowDefinitions="*,Auto" BackgroundColor="White">

        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="12" BackgroundColor="White">

                <Label Text="{Binding CurrentAcceso.Espacio.Titulo, FallbackValue='(Evento desconocido)'}"
                       FontSize="20" FontAttributes="Bold" TextColor="Black" />

                <Label Text="{Binding CurrentAcceso.MomentoDeAcceso, StringFormat='ðŸ“… {0:dd/MM/yyyy HH:mm}'}"
                       FontSize="14" TextColor="Black"/>

                <Label Text="{Binding CurrentAcceso.ResultadoStr, StringFormat='Resultado: {0}'}"
                       FontSize="14"  TextColor="Black"/>

                <Label Text="{Binding CurrentAcceso.Motivo, FallbackValue=''}"
                       FontSize="13" TextColor="Black" />

                <VerticalStackLayout IsVisible="{Binding IsPermittedAccess}">
                    <Label Text="BENEFICIOS DEL ESPACIO"
                           FontSize="23" TextColor="Black" Margin="0,15,0,0" />

                   
                    <Grid ColumnDefinitions="*,*" Margin="0,10,0,10">
                        <Label Grid.Column="0"
                               Text="{Binding BeneficiosYaCanjeados, StringFormat='Ya canjeados: {0}'}"
                               FontSize="14" 
                               TextColor="Green" 
                               FontAttributes="Bold" />
                        <Label Grid.Column="1"
                               Text="{Binding BeneficiosDisponiblesParaSeleccionar, StringFormat='Disponibles: {0}'}"
                               FontSize="14" 
                               TextColor="Blue" 
                               FontAttributes="Bold"
                               HorizontalTextAlignment="End" />
                    </Grid>

                    <Label Text="Toca los beneficios disponibles para seleccionarlos"
                           FontSize="14" TextColor="Gray" Margin="0,0,0,10" />

                    <Label Text="{Binding BeneficiosSeleccionados.Count, StringFormat='Seleccionados para canjear: {0}'}"
                           FontSize="14" TextColor="Orange" Margin="0,0,0,10" />

                    
                    <CollectionView ItemsSource="{Binding Beneficios}" Margin="0,10,0,0">
                        <CollectionView.EmptyView>
                            <Label Text="No hay beneficios para este espacio."
                                   TextColor="Gray"
                                   FontSize="14"
                                   HorizontalOptions="Center" />
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="12" Margin="0,5" CornerRadius="8">
                                    <Frame.Style>
                                        <Style TargetType="Frame">
                                            <Setter Property="BorderColor" Value="#ccc" />
                                            <Setter Property="BackgroundColor" Value="White" />
                                            <Style.Triggers>
                                                <!-- Beneficio ya canjeado -->
                                                <DataTrigger TargetType="Frame" Binding="{Binding YaCanjeado}" Value="True">
                                                    <Setter Property="BorderColor" Value="#28a745" />
                                                    <Setter Property="BackgroundColor" Value="#d4edda" />
                                                </DataTrigger>
                                                <!-- Beneficio seleccionado para canjear -->
                                                <DataTrigger TargetType="Frame" Binding="{Binding IsSelected}" Value="True">
                                                    <Setter Property="BorderColor" Value="#007ACC" />
                                                    <Setter Property="BackgroundColor" Value="#E3F2FD" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Frame.Style>

                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnBeneficioTapped" />
                                    </Frame.GestureRecognizers>

                                    <Grid ColumnDefinitions="*,Auto">
                                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                                            <Label Text="{Binding Nombre}"
                                                   FontSize="18"
                                                   TextColor="Black"
                                                   FontAttributes="Bold" />

                                            <Label Text="{Binding Tipo}"
                                                   FontSize="14"
                                                   TextColor="#555" />

                                            <Label Text="{Binding Descripcion}"
                                                   FontSize="13"
                                                   TextColor="#444"
                                                   LineBreakMode="WordWrap" />

                                            <Label Text="{Binding VigenciaInicio, StringFormat='Desde: {0:dd/MM/yyyy}'}"
                                                   FontSize="12"
                                                   TextColor="#666" />

                                            <Label Text="{Binding VigenciaFin, StringFormat='Hasta: {0:dd/MM/yyyy}'}"
                                                   FontSize="12"
                                                   TextColor="#666" />
                                        </VerticalStackLayout>

                                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="5">
                                            <Label Text="âœ… CANJEADO"
                                                   FontSize="12"
                                                   TextColor="#28a745"
                                                   FontAttributes="Bold"
                                                   HorizontalTextAlignment="Center"
                                                   IsVisible="{Binding YaCanjeado}" />

                                           
                                            <Label Text="âœ“"
                                                   FontSize="20"
                                                   TextColor="#007ACC"
                                                   HorizontalTextAlignment="Center"
                                                   IsVisible="{Binding IsSelected}" />
                                        </VerticalStackLayout>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- BotÃ³n de canjear beneficios -->
                    <Button Text="{Binding BeneficiosSeleccionados.Count, StringFormat='ðŸŽ Canjear {0} Beneficio(s)'}"
                            BackgroundColor="#28A745"
                            TextColor="White"
                            FontSize="16"
                            FontAttributes="Bold"
                            CornerRadius="10"
                            Margin="0,20,0,10"
                            Padding="15"
                            IsVisible="{Binding CanRedeemBenefits}"
                            Clicked="OnCanjearBeneficiosClicked" />

                   

                </VerticalStackLayout>

                <Label Text="Los beneficios solo estÃ¡n disponibles para accesos permitidos."
                       FontSize="14" 
                       TextColor="Orange" 
                       Margin="0,15,0,0"
                       IsVisible="{Binding IsNonPermittedAccess}" />

            </VerticalStackLayout>
        </ScrollView>

        <views:Navbar Grid.Row="1" />
    </Grid>
</ContentPage>