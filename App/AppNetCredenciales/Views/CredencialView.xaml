<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:AppNetCredenciales.Views"
             x:Class="AppNetCredenciales.Views.CredencialView"
             Title="Credencial" BackgroundColor="#f5f5f5">

    <Grid RowDefinitions="*,Auto">

        <ScrollView Grid.Row="0" Padding="20">
            <VerticalStackLayout Spacing="20">

                <Frame CornerRadius="20"
                       Padding="20"
                       BackgroundColor="White"
                       HasShadow="True"
                       BorderColor="#ddd">
                    <VerticalStackLayout Spacing="15">

                        <Label Text="Credencial"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="#333"/>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Tipo:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.TipoStr}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Estado:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.EstadoStr}" Grid.Column="1" TextColor="{Binding Credencial.EstadoStr, Converter={StaticResource EstadoColorConverter}}"/>
                        </Grid>
                        
                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="ID Criptogr谩fico:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.IdCriptografico}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Fecha Emisi贸n:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.FechaEmision, StringFormat='{0:dd/MM/yyyy}'}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Fecha Expiraci贸n:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.FechaExpiracion, StringFormat='{0:dd/MM/yyyy}'}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                    </VerticalStackLayout>
                </Frame>

                <!-- NUEVO: Bot贸n para ESCRIBIR credencial en chip NFC -->
                <Frame CornerRadius="15"
                       Padding="20"
                       BackgroundColor="#FFF3E0"
                       HasShadow="False"
                       BorderColor="#FF9800">
                    <VerticalStackLayout Spacing="15">
                        
                        <Label Text=" Configurar Mi Chip NFC"
                               FontSize="20"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="#F57C00"/>

                        <Label Text="Escribe tu credencial en tu chip NFC personal (tarjeta, pulsera, etc.) para usarlo en los puntos de acceso."
                               FontSize="14"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               TextColor="#E65100"
                               Margin="0,0,0,10"/>

                        <Button Text=" Escribir en Mi Chip NFC"
                                BackgroundColor="#FF9800"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="50"
                                FontSize="16"
                                FontAttributes="Bold"
                                Command="{Binding EscribirEnChipNFCCommand}"
                                IsEnabled="{Binding CanWriteNFC}"/>

                        <!-- Indicador de progreso -->
                        <ActivityIndicator IsRunning="{Binding IsWritingNFC}"
                                          IsVisible="{Binding IsWritingNFC}"
                                          Color="#FF9800"
                                          HeightRequest="30"/>

                        <!-- Mensaje de estado -->
                        <Label Text="{Binding NFCStatusMessage}"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               TextColor="#F57C00"/>

                        <Label Text="锔 Solo necesitas hacer esto UNA VEZ por chip."
                               FontSize="12"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               TextColor="#757575"
                               Margin="0,10,0,0"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Bot贸n para usar NFC (existente - para lectura en t贸tems) -->
                <Frame CornerRadius="15"
                       Padding="20"
                       BackgroundColor="#E3F2FD"
                       HasShadow="False"
                       BorderColor="#2196F3">
                    <VerticalStackLayout Spacing="15">
                        
                        <Label Text=" Acceso NFC"
                               FontSize="20"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="#1976D2"/>

                        <Label Text="Acerca tu dispositivo al lector para validar tu acceso"
                               FontSize="14"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               TextColor="#1565C0"/>

                        <Button Text=" Activar NFC para Acceso"
                                BackgroundColor="#2196F3"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="50"
                                FontSize="16"
                                FontAttributes="Bold"
                                Clicked="OnActivarNFCClicked"/>

                        <Label Text="Mant茅n esta pantalla activa y acerca el dispositivo al lector"
                               FontSize="12"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               TextColor="#757575"
                               IsVisible="{Binding IsNFCActive}"/>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

        <views:Navbar Grid.Row="1" />
    </Grid>
</ContentPage>
