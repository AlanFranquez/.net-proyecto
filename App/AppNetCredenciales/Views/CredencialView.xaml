<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:AppNetCredenciales.Views"
             x:Class="AppNetCredenciales.Views.CredencialView"
             Title="Credencial" BackgroundColor="#f5f5f5">

    <Grid RowDefinitions="*,Auto">

        <ScrollView Grid.Row="0" Padding="20">
            <VerticalStackLayout Spacing="20">

                <Frame CornerRadius="20"
                       Padding="20"
                       BackgroundColor="White"
                       HasShadow="True"
                       BorderColor="#ddd">
                    <VerticalStackLayout Spacing="15">

                        <Label Text="Credencial"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="#333"/>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Tipo:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.TipoStr}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Estado:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.EstadoStr}" Grid.Column="1" TextColor="{Binding Credencial.EstadoStr, Converter={StaticResource EstadoColorConverter}}"/>
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="ID Criptográfico:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.IdCriptografico}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Fecha Emisión:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.FechaEmision, StringFormat='{0:dd/MM/yyyy}'}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <Label Text="Fecha Expiración:" FontAttributes="Bold" TextColor="#555"/>
                            <Label Text="{Binding Credencial.FechaExpiracion, StringFormat='{0:dd/MM/yyyy}'}" Grid.Column="1" TextColor="#222"/>
                        </Grid>

                    </VerticalStackLayout>
                </Frame>

                <!-- Sección NFC (NFC Data Exchange) -->
                <Frame CornerRadius="20"
                       Padding="20"
                       BackgroundColor="White"
                       HasShadow="True"
                       BorderColor="#ddd">
                    <VerticalStackLayout Spacing="15">

                        <Label Text="Credencial NFC"
                               FontSize="20"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="#333"/>

                        <Label Text="Activa tu credencial NFC para acceder acercando tu dispositivo al lector"
                               FontSize="14"
                               TextColor="#666"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>

                        <!-- Botón dinámico que cambia según el estado -->
                        <Button Text="{Binding NfcButtonText}"
                                Command="{Binding ToggleNfcCommand}"
                                TextColor="White"
                                CornerRadius="12"
                                Padding="0,15"
                                FontSize="16"
                                FontAttributes="Bold"
                                Margin="0,10,0,0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsNfcActive}" Value="True">
                                    <Setter Property="BackgroundColor" Value="#4CAF50"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Button" Binding="{Binding IsNfcActive}" Value="False">
                                    <Setter Property="BackgroundColor" Value="#757575"/>
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>

                        <!-- Botón para escribir en tag físico -->
                        <Button Text="✍️ Escribir en Tag NFC"
                                Command="{Binding WriteToTagCommand}"
                                BackgroundColor="#2196F3"
                                TextColor="White"
                                CornerRadius="12"
                                Padding="0,15"
                                FontSize="16"
                                FontAttributes="Bold"
                                Margin="0,5,0,0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsNfcActive}" Value="True">
                                    <Setter Property="IsEnabled" Value="False"/>
                                    <Setter Property="Opacity" Value="0.5"/>
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>

                        <!-- Información sobre escritura de tags -->
                        <Label Text="Escribe tu credencial en un tag NFC físico para usarlo cuando no tengas el celular"
                               FontSize="11"
                               TextColor="#999"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               Margin="0,5,0,0"/>

                        <!-- Indicador de estado activo -->
                        <Frame BackgroundColor="#E8F5E9"
                               CornerRadius="8"
                               Padding="15"
                               HasShadow="False"
                               BorderColor="#4CAF50">
                            <Frame.Triggers>
                                <DataTrigger TargetType="Frame" Binding="{Binding IsNfcActive}" Value="False">
                                    <Setter Property="IsVisible" Value="False"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Frame" Binding="{Binding IsNfcActive}" Value="True">
                                    <Setter Property="IsVisible" Value="True"/>
                                </DataTrigger>
                            </Frame.Triggers>
                            <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                                <Label Text="✓"
                                       FontSize="18"
                                       TextColor="#4CAF50"
                                       FontAttributes="Bold"/>
                                <Label Text="Credencial NFC activa"
                                       FontSize="14"
                                       TextColor="#2E7D32"
                                       FontAttributes="Bold"/>
                            </HorizontalStackLayout>
                        </Frame>

                        <!-- Instrucciones cuando está activo -->
                        <Label Text="Acerca tu dispositivo al lector para registrar tu acceso"
                               FontSize="12"
                               TextColor="#666"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               Margin="0,5,0,0">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding IsNfcActive}" Value="False">
                                    <Setter Property="IsVisible" Value="False"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding IsNfcActive}" Value="True">
                                    <Setter Property="IsVisible" Value="True"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>

                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

        <views:Navbar Grid.Row="1" />
    </Grid>
</ContentPage>
