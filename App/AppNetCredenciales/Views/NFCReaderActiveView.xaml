<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AppNetCredenciales.Views.NFCReaderActiveView"
             Title="Lector NFC Activo"
             BackgroundColor="{Binding BackgroundColor}">

    <Grid>
        <!-- Fondo de color segun estado -->
        <BoxView Color="{Binding BackgroundColor}" />

        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="20" VerticalOptions="Center">

                <!-- Estado del lector -->
                <Frame BackgroundColor="White"
                       CornerRadius="20"
                       HasShadow="True"
                       Padding="30"
                       Opacity="0.95">
                    <VerticalStackLayout Spacing="15">
                        
                        <!-- Icono grande del estado -->
                        <Label Text="{Binding StatusIcon}"
                               FontSize="80"
                               HorizontalOptions="Center"/>

                        <!-- Nombre del espacio -->
                        <Label Text="{Binding EspacioNombre}"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               TextColor="#333"/>

                        <!-- Mensaje de estado -->
                        <Label Text="{Binding StatusMessage}"
                               FontSize="18"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               TextColor="{Binding StatusColor}"
                               FontAttributes="Bold"/>

                        <!-- Indicador de lectura animado -->
                        <ActivityIndicator IsRunning="{Binding IsReading}"
                                         Color="#2196F3"
                                         HeightRequest="40"
                                         WidthRequest="40"
                                         HorizontalOptions="Center"
                                         IsVisible="{Binding IsReading}"/>

                    </VerticalStackLayout>
                </Frame>

                <!-- Informaci�n del �ltimo acceso -->
                <Frame BackgroundColor="White"
                       CornerRadius="15"
                       HasShadow="True"
                       Padding="20"
                       IsVisible="{Binding HasLastResult}"
                       Opacity="0.95">
                    <VerticalStackLayout Spacing="12">
                        
                        <Label Text="�ltimo Acceso"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#333"
                               HorizontalOptions="Center"/>

                        <BoxView HeightRequest="1"
                                 Color="#E0E0E0"
                                 Margin="0,5"/>

                        <!-- Nombre completo -->
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="??"
                                   FontSize="20"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding LastNombreCompleto}"
                                   FontSize="16"
                                   TextColor="#333"
                                   VerticalOptions="Center"
                                   FontAttributes="Bold"/>
                        </HorizontalStackLayout>

                        <!-- Documento -->
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="??"
                                   FontSize="20"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding LastDocumento}"
                                   FontSize="16"
                                   TextColor="#666"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>

                        <!-- Resultado -->
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="{Binding LastResultIcon}"
                                   FontSize="20"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding LastResultMessage}"
                                   FontSize="16"
                                   TextColor="{Binding LastResultColor}"
                                   VerticalOptions="Center"
                                   FontAttributes="Bold"/>
                        </HorizontalStackLayout>

                        <!-- Hora -->
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="?"
                                   FontSize="20"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding LastAccessTime}"
                                   FontSize="14"
                                   TextColor="#999"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>

                    </VerticalStackLayout>
                </Frame>

                <!-- Botones de acci�n -->
                <VerticalStackLayout Spacing="15">
                    
                    <!-- Bot�n Ver Historial -->
                    <Button Text="?? Ver Historial"
                            BackgroundColor="#2196F3"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="50"
                            FontSize="16"
                            FontAttributes="Bold"
                            Command="{Binding VerHistorialCommand}"/>

                    <!-- Bot�n Simular Lectura (solo para desarrollo) -->
                    <Button Text="?? Simular Lectura (Test)"
                            BackgroundColor="#FF9800"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="50"
                            FontSize="14"
                            Command="{Binding SimularLecturaCommand}"
                            IsVisible="{Binding ModoDesarrollo}"/>

                    <!-- Bot�n Detener -->
                    <Button Text="? Detener Lector"
                            BackgroundColor="#757575"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="50"
                            FontSize="16"
                            FontAttributes="Bold"
                            Clicked="OnDetenerClicked"/>

                </VerticalStackLayout>

                <!-- Instrucciones -->
                <Frame BackgroundColor="#E3F2FD"
                       CornerRadius="10"
                       HasShadow="False"
                       Padding="15"
                       Opacity="0.95">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="?? Instrucciones:"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#1976D2"/>
                        <Label Text="� El usuario debe acercar su dispositivo"
                               FontSize="12"
                               TextColor="#1565C0"/>
                        <Label Text="� La validaci�n es autom�tica"
                               FontSize="12"
                               TextColor="#1565C0"/>
                        <Label Text="� El lector permanece activo continuamente"
                               FontSize="12"
                               TextColor="#1565C0"/>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
